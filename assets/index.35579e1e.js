var g=Object.defineProperty;var _=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var f=(t,e,r)=>e in t?g(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,h=(t,e)=>{for(var r in e||(e={}))j.call(e,r)&&f(t,r,e[r]);if(_)for(var r of _(e))y.call(e,r)&&f(t,r,e[r]);return t};import{j as jsx,H as Heading$1,d as dset,a as atom,s as splitAtom,T as Td,b as Tooltip,B as Button,F as FiInfo,u as useAtom,c as jsxs,e as Fragment,f as Table,g as Thead,h as Tr,i as Th,k as Tbody,R as ReactJson,l as ButtonGroup,m as FiTrash2,n as FiXOctagon,o as Box,r as react,p as index,q as FiArrowLeft,t as FiLogIn,v as FiPlay,w as FiAlignLeft,x as FiSave,y as FiEyeOff,z as FiEye,S as SplitPane,A as ReactDOM,C as React,D as ChakraProvider}from"./vendor.bdc0d97f.js";const p=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const s of a)if(s.type==="childList")for(const n of s.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&o(n)}).observe(document,{childList:!0,subtree:!0});function r(a){const s={};return a.integrity&&(s.integrity=a.integrity),a.referrerpolicy&&(s.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?s.credentials="include":a.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(a){if(a.ep)return;a.ep=!0;const s=r(a);fetch(a.href,s)}};p();function Heading({size:t="md",textAlign:e="center",spacing:r=1,children:o}){return jsx(Heading$1,{size:t,textAlign:e,pb:r,pt:r,color:"gray.600",backgroundColor:"gray.50",borderColor:"gray.100",borderBottomWidth:1,children:o})}const scriptRel="modulepreload",seen={},base="/",__vitePreload=function(e,r){return!r||r.length===0?e():Promise.all(r.map(o=>{if(o=`${base}${o}`,o in seen)return;seen[o]=!0;const a=o.endsWith(".css"),s=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${o}"]${s}`))return;const n=document.createElement("link");if(n.rel=a?"stylesheet":scriptRel,a||(n.as="script",n.crossOrigin=""),n.href=o,document.head.appendChild(n),a)return new Promise((i,l)=>{n.addEventListener("load",i),n.addEventListener("error",l)})})).then(()=>e())},demo=[{title:"Data model",examples:[{title:"Mental Model",docs:__vitePreload(()=>import("./readme.70cfd83e.js"),[]),final:!0}]},{title:"Write property and create document",examples:[{title:"Create object at path",docs:__vitePreload(()=>import("./100-create-obj.167ecf34.js"),[]),code:'({ op: "create", path: "/things/", value: { a: 1, b:2 } })',final:!0},{title:"Set property via id",docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "set", id: "<uuid>", prop: "b", value: "hi" })',final:!0},{title:"Set multiple propertis via id",docs:__vitePreload(()=>import("./103-set-prop-obj.edd5cb4e.js"),[]),code:'({ op: "set", id: "<uuid>", value: { obj: "boo", v: "foo" } })',final:!0}]},{title:"Delete field or document or sub-tree",examples:[{docs:__vitePreload(()=>import("./110-delete.7a359bf0.js"),[]),code:'({ op: "set", path: "/things/foo", prop: "text", value: null })',final:!0},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "set", path: "/things/foo", value: null })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "set", path: "/path/to", value: null })'}]},{title:"Basic queries of field, documents or sub-trees",examples:[{docs:__vitePreload(()=>import("./001-query.36937a17.js"),[]),code:'({ op: "query", path: "/things/<uuid>", prop: "text" })'},{docs:__vitePreload(()=>import("./001-query.36937a17.js"),[]),code:'({ op: "query", path: "/things/<uuid>" })',comment:"If id is used the item must exist! Optionally all objects without a path, will be written to /_uncategorized/*]"},{docs:__vitePreload(()=>import("./001-query.36937a17.js"),[]),code:'({ op: "query", path: "/things" })'},{docs:__vitePreload(()=>import("./001-query.36937a17.js"),[]),code:'({ op: "query", path: "/path" })'}]},{title:"Basic subscribtion of field, documents or sub-trees",examples:[{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "subscribe", path: "/things/<uuid>", prop: "text" })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "subscribe", path: "/things/<uuid>" })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "subscribe", path: "/things" })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "subscribe", path: "/path" })'}]},{title:"Replace folder with file and vice versa",examples:[{title:"Override existing property with conflicting path",docs:__vitePreload(()=>import("./102-set-prop-existing.b504999e.js"),[]),code:['({ op: "set", path: "/things/foo/text", prop: "text", value: "hello" })','({ op: "set", path: "/things/foo", prop: "text", value: "hello" })'].join(`
`)},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "set", path: "/things/foo", prop: "text", value: "boo" })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "set", path: "/things", prop: "text", value: "boo" })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "set", path: "/things/foo", prop: "text", value: "boo" })'}]},{title:"Optional syntactic sugar:",examples:[{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "create", path: "/things/<uuid>", value: { ... } })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "create", id: "<uuid>", value: { ... } })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "update", path: "/things/<uuid>", prop: "text", value: "boo" })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "update", id: "<uuid>", prop: "text", value: "boo" })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "update", path: "/things/<uuid>:text", value: "boo" })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "update", id: "<uuid>:text", value: "boo" })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "delete", path: "/path/to" })'},{docs:__vitePreload(()=>import("./101-set-prop.15e0a9eb.js"),[]),code:'({ op: "query", path: "/things/<uuid>:text" })'}]},{title:"Edge cases",examples:[{title:"Creating an empty document does nothing",code:'({ op: "create", path: "/things/", value: {} })'}]},{title:"Discussions",examples:[{title:"Indexing",docs:__vitePreload(()=>import("./indexing.b27a2355.js"),[])},{title:"UUIDs",docs:__vitePreload(()=>import("./uuid.94fa6706.js"),[]),final:!1},{title:"Log",docs:__vitePreload(()=>import("./log.89eb5970.js"),[])},{title:"Real-time",docs:__vitePreload(()=>import("./real-time.d30d7206.js"),[])},{title:"Special fields",docs:__vitePreload(()=>import("./special-fields.aff6f179.js"),[])},{title:"Storing parents",docs:__vitePreload(()=>import("./storing-parents.09d7b05c.js"),[])}]}],initialCode=demo[1].examples[0].code;async function series(...t){for(const e in t)await e}function parallel(...t){return Promise.all(t)}function collapse(t){const e={};for(const{k:r,v:o}of t)dset(e,r.replaceAll("/","."),o);return e}function stream(t,{gte:e,lt:r}={}){const o={data:a=>{},error:()=>{},close:()=>{},end:()=>{}};return setTimeout(()=>{for(const a of t.keys())a.localeCompare(e)>=0&&a.localeCompare(r)<0&&(o==null||o.data({key:a,value:t.get(a)}));o==null||o.close(),o==null||o.end()}),{on(a,s){return o[a]=s,this}}}function level(t,e){const r=new Map;return{async put(o,a){r.set(o,a)},async del(o){r.delete(o)},async get(o){return r.get(o)},createReadStream(o){return stream(r,o)},async clear(){r.clear()},async open(){},async close(){},isOpen:()=>!0,isClosed:()=>!0,isOperational:()=>!0,$debug(){return JSON.parse(JSON.stringify([...r.entries()],null,2))}}}function createReadStreamAsObj(t,e,r,{sep:o=":"}){const a={};return new Promise((s,n)=>{t.createReadStream({gte:e,lt:r}).on("data",i=>dset(a,i.key.replace(e+o,"").replaceAll(/[\/:]/g,"."),i.value)).on("error",n).on("close",()=>s(a))})}function createReadStreamAsArray(t,e,r){const o=[];return new Promise((a,s)=>{t.createReadStream({gte:e,lt:r}).on("data",n=>o.push(n)).on("error",s).on("close",()=>a(o))})}function PrimaryStorage(){const t=level();return{$debug:t.$debug,clear:t.clear.bind(t),setProp(e,r,o){return o?t.put(`${e}:${r}`,o):t.del(`${e}:${r}`)},getProp(e,r){return t.get(`${e}:${r}`)},updateObject(e,r){return parallel(...Object.keys(r).map(o=>t.put(`${e}:${o}`,r[o])))},setObject(e,r){return series(this.deleteObject(e),parallel(...Object.keys(r).map(o=>t.put(`${e}:${o}`,r[o]))))},async deleteObject(e){const r=await this.getObject(e);return parallel(...Object.keys(r).map(o=>t.del(`${e}:${o}`)))},async getObject(e){return createReadStreamAsObj(t,e,e+String.fromCharCode(255),{sep:":"})}}}function TreeIndex(){const t=level();let e=0;return{$debug:t.$debug,clear:t.clear.bind(t),async set(r,o){return r.endsWith("/")||(r+="/"),r=`${r}${e}`,e+=1,await parallel(t.put(r,o),t.put(o,r)),r},async deleteByPath(r){const o=await this.getByPath(r);return await parallel(t.del(o),t.del(r)),o},async deleteById(r){const o=await this.getById(r);return await parallel(t.del(r),t.del(o)),o},getByPath(r){return t.get(r)},getById(r){return t.get(r)},async getObjectIdsAtPath(r){return(await createReadStreamAsArray(t,r,r+String.fromCharCode(255))).map(({key:a,value:s})=>({path:a.substring(r.length,a.lastIndexOf("/")+1),id:s}))}}}function SubscriptionTable(){const t=level();return{$debug:t.$debug,clear:t.clear.bind(t),async subscribe(e,r){return await t.put(`${r}<-${e}`,"options"),e},async unsubscribe(e,r){await this.del(`${r}<-${e}`)},async match(e){}}}function hash(t){let e=0;for(let r=0;r<t.length;r++){const o=t.charCodeAt(r);e=(e<<5)-e+o,e=e&e}return e}function DB(){const t=PrimaryStorage(),e=TreeIndex(),r=SubscriptionTable(),o={};let a=0;return{clear(){return parallel(t.clear(),e.clear(),r.clear())},on(s,n){o[s]=n},$log(...s){o.log?o.log(s.map(n=>typeof n=="object"?JSON.stringify(n):n).join(" ")):console.log("\u{1F7E0}",...s)},async $state(){return this.getObjectsByPath("/")},$debug(){return t.$debug?{p:t.$debug(),t:e.$debug(),u:r.$debug(),s:this.$state.bind(this)}:{}},uuid(s=Math.random()){return a+=1,Math.abs(hash(`${s}:${a}`)).toString(16)},async createObject(s,n,i){return this.$log("createObject",{path:s,id:n,obj:i}),parallel(e.set(s,n),...Object.keys(i).map(l=>{t.setProp(n,l,i[l])}))},async updateObject(s,n){return this.$log("updateObject",{id:s,obj:n}),parallel(...Object.keys(n).map(i=>{t.setProp(s,i,n[i])}))},async deleteObjectByPath(s){this.$log("deleteObjectByPath",{path:s});const n=await e.deleteByPath(s);return t.deleteObject(n)},async deleteObjectById(s){return this.$log("deleteObjectById",{id:s}),parallel(e.deleteById(s),t.deleteObject(s))},async setProp(s,n,i){return this.$log("setProp",{id:s,prop:n,value:i}),t.setProp(s,n,i)},async getObjectById(s){return this.$log("getObjectById",{id:s}),t.getObject(s)},async getObjectsByPath(s){this.$log("getObjectsByPath",{path:s});const n=await e.getObjectIdsAtPath(s);return collapse(await parallel(...n.map(async({path:i,id:l})=>({k:`${i}${l}`,v:await t.getObject(l)}))))},async getProp(s,n){return this.$log("getProp",{id:s,prop:n}),t.getProp(s,n)},async getPathById(s){return this.$log("getPathById",{id:s}),e.getById(s)},async subscribeUserToPath(s,n){return this.$log("subscribeUser",{userId:s,path:n}),r.subscribe(s,n)},async unsubscribeUserFromPath(s,n){return this.$log("unsubscribeUserFromPath",{userId:s}),r.unsubscribe(s,n)}}}async function execMessage(t,e,{$log:r}){let o=null;switch(r("\u2709\uFE0F",e),e.op){case"init":{await t.createObject("/articles","id1",{foo:"bar",baz:"oak"}),await t.createObject("/articles","id2",{foo:"qux",baz:"db"}),await t.createObject("/articles/id1/sub","id3",{hello:"world"});break}case"create":{if(typeof e.value!="object")throw new Error("value must be an object");const a=t.uuid(e.path),[s]=await t.createObject(e.path,a,e.value);o={id:a,path:s};break}case"update":case"set":{e.prop?e.pathNotFound?(r("\u{1F535}","createObject due to not found",h({},e)),await t.createObject(e.pathAssumingDoc,e.id,{[e.prop]:e.value})):await t.setProp(e.id,e.prop,e.value):e.value===null?await t.deleteObjectByPath(e.path+"/"+e.id):e.pathNotFound?await t.createObject(e.path,e.id,e.value):await t.updateObject(e.id,e.value);break}case"delete":{e.pathNotFound?await t.deleteObjectByPath(e.path+"/"+e.id):await t.deleteObjectById(e.id);break}case"subscribe":case"query":{e.prop?o=await t.getProp(e.id,e.prop):e.pathNotFound?o=await t.getObjectsByPath(e.path):o=await t.getObjectById(e.id),e.op==="subscribe"&&await t.subscribeUserToPath(e.connectionId,e.path);break}case"unsubscribe":{await t.unsubscribeUserFromPath(e.connectionId,e.path);break}case"clear":{await t.clear();break}}return o}async function processMsg(t,e,{$log:r}){var a,s;const o=h({},e);if(o.pathBackup=o.path,(a=o.path)==null?void 0:a.includes(":")){const[n,i]=o.path.split(":");if(o.prop&&o.prop!==i)throw new Error("Prop provided twice");o.path=n,o.prop=i}if((s=o.id)==null?void 0:s.includes(":")){const[n,i]=o.id.split(":");if(o.prop&&o.prop!==i)throw new Error("Prop provided twice");o.id=n,o.prop=i}if(o.path&&!o.id){const n=o.path.split("/");o.id=n[n.length-1],o.path=n.slice(0,-1).join("/")}return o.pathAssumingDoc=o.path,o.path=await t.getPathById(o.id),o.path||(o.path=o.pathBackup,o.pathNotFound=!0),o.path&&(o.path=o.path.replace(/(\/)+/g,"$1")),o.path&&o.path.endsWith("/")&&(o.path=o.path.substring(0,o.path.length-1)),delete o.pathBackup,o.connectionId="con:1",o}function OakDB(){const t=DB();return t.clear(),{on(e,r){t.on(e,r)},async exec(e){const r={$log:t.$log.bind(t)},o=await processMsg(t,e,r),a=await execMessage(t,o,r),{p:s,t:n,s:i,u:l}=t.$debug();return{opvmap:s,bimap:n,subtab:l,state:i,result:a}}}}const oak=OakDB();function getOak(){return oak}const editorTextAtom=atom(initialCode),queryResultAtom=atom({}),opLogAtom=atom([]);splitAtom(opLogAtom);const stateAtom=atom({}),opvMapAtom=atom([]),biMapAtom=atom([]),subTabAtom=atom([]);function connectAtoms(){const t={};return opLogAtom.onMount=r=>t.setOpLog=r,opvMapAtom.onMount=r=>t.setOpvMap=r,biMapAtom.onMount=r=>t.setBiMap=r,subTabAtom.onMount=r=>t.setSubTab=r,stateAtom.onMount=r=>t.setState=r,queryResultAtom.onMount=r=>t.setResult=r,getOak().on("log",r=>t.setOpLog(o=>[...o,r])),async r=>{const{setOpLog:o,setBiMap:a,setOpvMap:s,setSubTab:n,setResult:i,setState:l}=t;o(b=>[...b,r]);const{opvmap:c,bimap:d,subtab:u,state:x,result:m}=await getOak().exec(r);return a(d),s(c),n(u),i(m),x().then(l),m}}const dispatchCmd=connectAtoms();function TdMono({children:t}){return jsx(Td,{pt:0,pb:0,fontSize:11,fontFamily:"monospace",children:t})}function TextTooltip({children:t}){return jsx(Tooltip,{label:jsx("span",{children:t}),fontSize:"md",children:jsx(Button,{variant:"link",position:"relative",display:"inline",pl:2,children:jsx(FiInfo,{})})})}function SubscriptionTabPane(){const[t]=useAtom(subTabAtom);return jsxs(Fragment,{children:[jsxs(Heading,{size:"md",children:["Subscription Table",jsx(TextTooltip,{children:"Subscription Table"})]}),jsxs(Table,{variant:"striped",size:"sm",children:[jsx(Thead,{children:jsxs(Tr,{children:[jsx(Th,{children:"Key"}),jsx(Th,{children:"Value"})]})}),jsx(Tbody,{children:t.map((e,r)=>jsxs(Tr,{children:[jsx(TdMono,{children:e[0]}),jsx(TdMono,{children:e[1]})]},r))})]})]})}function StatePane(){const[t]=useAtom(stateAtom);return jsxs(Fragment,{children:[jsx(Heading,{size:"md",children:"State"}),jsx(ReactJson,{src:t,theme:"monokai",style:{height:"100%"}})]})}function OpLogPane(){const[t,e]=useAtom(opLogAtom);return jsxs(Fragment,{children:[jsx("div",{className:"addressBar",children:jsxs(ButtonGroup,{children:[jsx(Button,{onClick:async()=>{await dispatchCmd({op:"clear"}),console.clear()},leftIcon:jsx(FiTrash2,{}),children:"Reset DB"}),jsx(Button,{onClick:async()=>{e([])},leftIcon:jsx(FiXOctagon,{}),children:"Clear Log"})]})}),jsx(Heading,{size:"md",children:"OpLog"}),jsx("pre",{style:{fontSize:"12px"},children:t.map((a,s)=>typeof a=="string"?jsxs("code",{children:["- ",a]},s):jsx("code",{style:{fontWeight:"bold"},children:JSON.stringify(a)},s))})]})}function QueryResultPane(){const[t]=useAtom(queryResultAtom);return jsxs(Fragment,{children:[jsx(Heading,{size:"md",children:"Query Result"}),jsx(Box,{background:"rgb(39, 40, 34)",color:"white",minHeight:"100%",fontSize:14,p:2,children:jsx("pre",{children:JSON.stringify(t,null,2)})})]})}function OPVMapPane(){const[t]=useAtom(opvMapAtom);return jsxs(Fragment,{children:[jsxs(Heading,{size:"md",children:["OPV-Map",jsx(TextTooltip,{children:"Object-property-value map"})]}),jsxs(Table,{variant:"striped",size:"sm",children:[jsx(Thead,{children:jsxs(Tr,{children:[jsx(Th,{children:"ObjectId"}),jsx(Th,{children:"Property"}),jsx(Th,{children:"Value"})]})}),jsx(Tbody,{children:t.map((e,r)=>jsx(Row,{item:e},r))})]})]})}function Row({item:t}){const[e,r]=t,[o,a]=e.split(":");return jsxs(Tr,{children:[jsx(TdMono,{children:o}),jsx(TdMono,{children:a}),jsx(TdMono,{children:r})]})}function BiMapPane(){const[t]=useAtom(biMapAtom);return jsxs(Fragment,{children:[jsxs(Heading,{size:"md",children:["Bi-Map",jsx(TextTooltip,{children:"Bijective path-to-id map"})]}),jsxs(Table,{variant:"striped",size:"sm",children:[jsx(Thead,{children:jsxs(Tr,{children:[jsx(Th,{children:"Key"}),jsx(Th,{children:"Value"})]})}),jsx(Tbody,{children:t.map((e,r)=>jsxs(Tr,{children:[jsx(TdMono,{children:e[0]}),jsx(TdMono,{children:e[1]})]},r))})]})]})}const options={fontSize:16,acceptSuggestionOnCommitCharacter:!0,acceptSuggestionOnEnter:"on",accessibilitySupport:"auto",autoIndent:!0,automaticLayout:!0,codeLens:!1,colorDecorators:!0,contextmenu:!0,cursorBlinking:"blink",cursorSmoothCaretAnimation:!1,cursorStyle:"line",disableLayerHinting:!1,disableMonospaceOptimizations:!1,dragAndDrop:!1,fixedOverflowWidgets:!1,folding:!0,foldingStrategy:"auto",fontLigatures:!1,formatOnPaste:!0,formatOnType:!0,hideCursorInOverviewRuler:!1,highlightActiveIndentGuide:!0,links:!0,mouseWheelZoom:!1,multiCursorMergeOverlapping:!0,multiCursorModifier:"alt",overviewRulerBorder:!0,overviewRulerLanes:2,quickSuggestions:!0,quickSuggestionsDelay:20,readOnly:!1,renderControlCharacters:!1,renderFinalNewline:!0,renderIndentGuides:!0,renderLineHighlight:"all",renderWhitespace:"none",revealHorizontalRightPadding:30,roundedSelection:!0,rulers:[],scrollBeyondLastColumn:5,scrollBeyondLastLine:!0,selectOnLineNumbers:!0,selectionClipboard:!0,selectionHighlight:!0,showFoldingControls:"mouseover",smoothScrolling:!1,suggestOnTriggerCharacters:!0,wordBasedSuggestions:!0,wordSeparators:`~!@#$%^&*()-=+[{]}|;:'",.<>/?`,wordWrap:"off",wordWrapBreakAfterCharacters:"	})]?|&,;",wordWrapBreakBeforeCharacters:"{([+",wordWrapBreakObtrusiveCharacters:".",wordWrapColumn:80,wordWrapMinified:!0,wrappingIndent:"none",minimap:{enabled:!1}};function Editor({ready:t,data:e,onChange:r,onValid:o,format:a}){const s=react.exports.useRef(null),n=e,i=c=>{s.current={format(){c.getAction("editor.action.formatDocument").run()}}};function l(c){let d=!0;try{r(c)}catch{d=!1}o(d)}return react.exports.useEffect(()=>{var c;(c=s==null?void 0:s.current)==null||c.format()},[a]),jsx("div",{className:"editor",children:t&&jsx(index,{defaultValue:n,onChange:l,defaultLanguage:"javascript",theme:"vs-dark",onMount:i,options,path:"default.json"})})}function Help({mdPromise:t}){const[e,r]=react.exports.useState(null);return react.exports.useEffect(()=>{t.then(({html:o})=>r(o))},[t]),jsx(Box,{p:8,className:"markdown-body",children:jsx("div",{dangerouslySetInnerHTML:{__html:e}})})}function mapMultiLineCode(t){return t.split(`
`).map(e=>jsxs("code",{className:"codeSnippet",children:[e,jsx("br",{}),jsx("br",{})]},e))}function Group({title:t,examples:e,onInsert:r,onSelectInfo:o}){return jsxs("div",{children:[jsx(Heading,{size:"sm",spacing:4,children:t}),jsx(Table,{variant:"striped",size:"sm",children:jsx(Tbody,{children:e.map((a,s)=>jsxs(Tr,{opacity:a.final?1:.5,children:[jsx(Td,{style:{width:"100%"},children:jsx(Button,{variant:"link",fontWeight:500,onClick:()=>o(a),children:a.title?a.title:jsxs("code",{children:[a.code.substring(0,32),"..."]})})}),jsx(Td,{children:jsx(ButtonGroup,{isAttached:!0,spacing:0,size:"sm",variant:"solid",children:a.code&&jsx(Tooltip,{label:jsxs("div",{children:[jsx("span",{children:"Insert snippet into query editor:"}),jsx("br",{}),jsx("br",{}),mapMultiLineCode(a.code)]}),children:jsx(Button,{leftIcon:jsx(FiLogIn,{}),size:"sm",onClick:()=>r(a)})})})})]},s))})})]})}function CommandsPane({onInsertCode:t}){const[e,r]=react.exports.useState(null),o=({code:s})=>{t(s),r(null)},a=s=>{r(s)};return e?jsxs(Fragment,{children:[jsx(Button,{leftIcon:jsx(FiArrowLeft,{}),onClick:()=>r(null),width:"100%",children:"GoBack"}),jsx(Help,{mdPromise:e.docs})]}):jsxs(Box,{children:[jsx(Heading,{size:"md",spacing:4,children:"Available Commands"}),jsx(Box,{mb:12,children:demo.map(({title:s,examples:n})=>jsx(Group,{title:s,examples:n,onInsert:o,onSelectInfo:a},s))})]})}function EditorPane({isReady:_isReady}){const[isReady,setIsReady]=react.exports.useState(_isReady),[data,setData]=useAtom(editorTextAtom),[previousQueryResult]=useAtom(queryResultAtom),[formatCounter,setFormatCounter]=react.exports.useState(0),[isValid,setIsValid]=react.exports.useState(!0),[isDirty,setIsDirty]=react.exports.useState(!1),[showCommands,setShowCommands]=react.exports.useState(!1);react.exports.useEffect(()=>{const t=window.localStorage.getItem("oak.editor");t&&setData(t),setIsReady(!0)},[]);const onChange=t=>{setIsDirty(!0),setData(t)},onSaveToFile=()=>{window.localStorage.setItem("oak.editor",data),setIsDirty(!1)},onInsertCode=t=>{setShowCommands(!1);const e=o=>o.startsWith("//")?o:`// ${o}`,r=o=>{var a;return o.replaceAll("<uuid>",(a=previousQueryResult==null?void 0:previousQueryResult.id)!=null?a:"<uuid>")};setData((o="")=>[...o.split(`
`).map(e),r(t)].join(`
`))},onRun=async()=>{for(const cmdText of data.split(`
`)){if(!cmdText.trim()||cmdText.trim().startsWith("//"))continue;const cmd=eval(`(() => (${cmdText}))()`);await dispatchCmd(cmd)}};return jsxs(Fragment,{children:[jsx("div",{className:"addressBar",children:jsxs(ButtonGroup,{children:[jsx(Button,{onClick:onRun,leftIcon:jsx(FiPlay,{}),disabled:!isValid,colorScheme:"orange",children:"Run"}),jsx(Button,{onClick:()=>setFormatCounter(t=>t+1),leftIcon:jsx(FiAlignLeft,{}),children:"Format"}),jsxs(Button,{onClick:onSaveToFile,leftIcon:jsx(FiSave,{}),children:["Save ",isDirty?"*":""]}),jsx(Button,{onClick:()=>setShowCommands(t=>!t),leftIcon:showCommands?jsx(FiEyeOff,{}):jsx(FiEye,{}),children:showCommands?"Hide Commands":"Show Commands"})]})}),showCommands?jsx("div",{style:{overflow:"scroll",height:"100%"},children:jsx(CommandsPane,{onInsertCode})}):jsx("div",{style:{height:"100%"},children:jsx(Editor,{data,onChange,onValid:setIsValid,ready:isReady,format:formatCounter})})]})}function App(){const[t,e]=react.exports.useState(!1);return react.exports.useEffect(()=>{e(!0)},[]),jsx(Fragment,{children:jsxs(SplitPane,{split:"vertical",defaultSize:"33%",primary:"first",children:[jsxs(SplitPane,{split:"horizontal",defaultSize:"85%",children:[jsx("div",{className:"boxWithoutScroll",children:jsx(EditorPane,{isReady:t})}),jsx("div",{className:"box",children:jsx(QueryResultPane,{})})]}),jsxs(SplitPane,{split:"vertical",defaultSize:"50%",children:[jsxs(SplitPane,{split:"horizontal",defaultSize:"80%",children:[jsxs(SplitPane,{split:"horizontal",defaultSize:"50%",children:[jsx("div",{className:"box",children:jsx(OPVMapPane,{})}),jsx("div",{className:"box",children:jsx(BiMapPane,{})})]}),jsx("div",{className:"boxWithoutScroll",children:jsx(SubscriptionTabPane,{})})]}),jsxs(SplitPane,{split:"horizontal",defaultSize:"50%",children:[jsx("div",{className:"box",children:jsx(OpLogPane,{})}),jsx("div",{className:"box",children:jsx(StatePane,{})})]})]})]})})}var global="",app="";ReactDOM.render(jsx(React.StrictMode,{children:jsx(ChakraProvider,{children:jsx(App,{})})}),document.getElementById("app"));
